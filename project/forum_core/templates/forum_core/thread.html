{% extends "base.html" %} {% block title %}{{ thread.title }}{% endblock %} 
{% block content %}
<div class="forum-container">
  <div class="thread-header">
    <a href="{% url 'forum_core:home' %}" class="back-link">‚Üê Back to Forums</a>
    <h1>{{ thread.title }}</h1>
    <div class="thread-meta">
      <span class="thread-author">
        Posted by
        <a
          href="{% url 'forum_core:user_profile' thread.created_by.username %}"
          class="profile-link"
          >{{ thread.created_by.username }}</a
        >
      </span>
      <span class="thread-date">{{ thread.created_at|date:"M d, Y H:i" }}</span>

      {% if request.user == thread.created_by or request.user.user_type == 'MODERATOR' %}
      <div class="thread-actions">
        <a
          href="{% url 'forum_core:edit_thread' thread.id %}"
          class="action-link edit-link"
          >Edit</a
        >
        <form
          action="{% url 'forum_core:delete_thread' thread.id %}"
          method="POST"
          style="display: inline"
        >
          {% csrf_token %}
          <button
            type="submit"
            class="action-link delete-link"
            onclick="return confirm('Are you sure?')"
          >
            Delete
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="thread-content-card">
    <div class="thread-main-content">{{ thread.content|linebreaks }}</div>
  </div>

  <div class="comments-section">
    <h3>{{ comments.count }} Comments</h3>
    <div class="comments-list">
      {% for comment in comments %}
      <div class="comment-card">
        <div class="comment-meta">
          <span class="comment-author">
            <a
              href="{% url 'forum_core:user_profile' comment.created_by.username %}"
              class="profile-link"
              >{{ comment.created_by.username }}</a
            >
          </span>
          <span class="comment-date"
            >{{ comment.created_at|date:"M d, Y H:i" }}</span
          >

          {% if request.user == comment.created_by or request.user.user_type == 'MODERATOR' %}
          <div class="comment-actions">
            <a
              href="{% url 'forum_core:edit_comment' comment.id %}"
              class="action-link edit-link"
              >Edit</a
            >
            <form
              action="{% url 'forum_core:delete_comment' comment.id %}"
              method="POST"
              style="display: inline"
            >
              {% csrf_token %}
              <button
                type="submit"
                class="action-link delete-link"
                onclick="return confirm('Are you sure?')"
              >
                Delete
              </button>
            </form>
          </div>
          {% endif %}
        </div>
        <div class="comment-body">{{ comment.content|linebreaks }}</div>
      </div>
      {% empty %}
      <div class="empty-comments">
        <p>No comments yet. Be the first to reply!</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="comment-form-section">
    <h3>Add a Comment</h3>
    <form method="POST">
      {% csrf_token %}
      <div class="form-group">{{ form.content }}</div>
      <button type="submit" class="btn btn-primary">Post Comment</button>
    </form>
  </div>
</div>

<style>
  .thread-header {
    margin-bottom: 2rem;
    border-bottom: 2px solid #000;
    padding-bottom: 1rem;
  }
  .back-link {
    color: #000;
    text-decoration: none;
    display: block;
    margin-bottom: 1rem;
    font-weight: 700;
  }
  .thread-content-card {
    background: white;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 2px solid #000;
  }
  .comments-section {
    margin-top: 3rem;
  }
  .comment-card {
    background: white;
    padding: 1.5rem;
    border: 2px solid #000;
    margin-bottom: 1rem;
  }
  .comment-meta {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 0.5rem;
  }
  .comment-author {
    font-weight: 700;
    color: #000;
    margin-right: 1rem;
  }
  .profile-link {
    color: inherit;
    text-decoration: none;
    font-weight: 800;
  }
  .profile-link:hover {
    text-decoration: underline;
  }
  .comment-form-section {
    margin-top: 3rem;
    padding: 2rem;
    background: white;
    border: 2px solid #000;
  }
  /* Ensure form-input matches the high-contrast theme */
  .forum-container textarea,
  .forum-container input[type="text"] {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #000;
    background: white;
    color: black;
    margin-bottom: 1rem;
    font-family: inherit;
    box-sizing: border-box;
  }
  .btn-primary {
    background: #000;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
  }
  .btn-primary:hover {
    background: #333;
  }
  .action-link {
    font-size: 0.8rem;
    font-weight: 700;
    text-decoration: none;
    margin-left: 1rem;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    font-family: inherit;
  }
  .edit-link {
    color: #000;
  }
  .delete-link {
    color: #ff0000;
  }

  .thread-actions,
  .comment-actions {
    display: inline-block;
    vertical-align: middle;
  }
</style>
{% endblock %}
